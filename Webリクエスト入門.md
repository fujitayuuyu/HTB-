# 1 HTTPの基礎
## (1) http
### ① URLの構成
![image](https://github.com/user-attachments/assets/68e0a3cf-8e68-4500-80f3-8ec93a439b57)

| **Component**    | **Example**         | **Description**                                                                                                                                                   |
| ---------------- | ------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Scheme**       | http:// https://     | クライアントがアクセスするプロトコルを識別するために使い、コロンとダブルスラッシュ (://) で終わる。                                                                 |
| **User Info**    | admin:password@      | 認証に使う資格情報（コロンで区切る）が含まれるオプションのコンポーネントで、ホストとはアットマーク (@) で区切る。                                                  |
| **Host**         | inlanefreight.com    | ホストはリソースの場所を示す。ホスト名またはIPアドレスで指定されることがある。                                                                                      |
| **Port**         | :80                  | ポートはホストとはコロン (:) で区切る。ポートが指定されていない場合、httpはデフォルトでポート80、httpsはポート443を使う。                                           |
| **Path**         | /dashboard.php       | アクセスしているリソース（ファイルやフォルダ）を指す。パスが指定されていない場合、サーバーはデフォルトのインデックス (例: index.html) を返す。                       |
| **Query String** | ?login=true          | クエリ文字列はクエスチョンマーク (?) で始まり、パラメータ (例: login) と値 (例: true) から構成される。複数のパラメータはアンパサンド (&) で区切ることができる。         |
| **Fragments**    | #status              | フラグメントは、クライアント側のブラウザによって処理され、メインリソース内のセクション (例: ページ内のヘッダーやセクション) を特定するために使う。                     |

### ② Webの動き
![image](https://github.com/user-attachments/assets/a8c7cac2-4b11-4506-8ec9-3032753fb3ae)

## (2) https
### ① httpsのフロー
![image](https://github.com/user-attachments/assets/a3fe6b7a-8109-44eb-825c-369364fc9c3b)

### ② curlでSSL証明書のチェックをスキップする方法
> ```
> curl -k $URL
> ```

## (3) HTTPのリクエスト、レスポンス
### ① http request
![image](https://github.com/user-attachments/assets/01e40533-48cc-4533-8f47-c8b3a4617bac)

### ② http response
![image](https://github.com/user-attachments/assets/d2fc9c32-a901-49fc-8c7c-0de35cc016c0)

### ③ curlでリクエストとレスポンスを全表示する方法
```
curl $URL -v
```

## (4) HTTPヘッダー
### ① 一般的なヘッダー
| Header      | Example                                    | Description                 |
|-------------|--------------------------------------------|--------------------------|
| Date        | Date: Wed, 16 Feb 2022 10:38:44 GMT        | メッセージが生成された日時を保持します。時間は標準のUTCタイムゾーンに変換することが推奨されます。 |
| Connection  | Connection: close                          | リクエストが完了した後、現在のネットワーク接続を維持するかどうかを指定します。このヘッダーの一般的な値は「close」と「keep-alive」の2つです。「close」はクライアントまたはサーバーが接続を終了したいことを意味し、「keep-alive」は接続を維持し、追加のデータや入力を受信することを示します。 |

### ② エンティティヘッダ
| Header           | Example                            | Description                                                                                                      |
|------------------|------------------------------------|------------------------------------------------------------------------------------------------------------------|
| Content-Type     | Content-Type: text/html            | 転送するリソースの種類を指定。charset フィールドでエンコーディング（例: UTF-8）を指定。                                  |
| Media-Type       | Media-Type: application/pdf        | Content-Type と同様にデータの種類を指定。charset フィールドも使える。                                                |
| Boundary         | boundary="b4e4fbd93540"            | メッセージ内の複数のコンテンツを区切るためのマーカー。フォームデータの部分を分けるのに使う。                                |
| Content-Length   | Content-Length: 385                | 転送するデータのサイズを指定。ブラウザやツールが自動で生成。                                                       |
| Content-Encoding | Content-Encoding: gzip             | データを圧縮などで変換した場合に使用。どんなエンコーディングかを示す。                                                |

#### ■ セキュリティ的に
##### ◇ ファイルのアップロードでファイルデータを「Content-Type」のみでやってしまうと  
Content-Type自体ユーザ側で変更可能なのでphp形式のファイルなのにcontent-typeを「image/jpeg」に偽装してファイルをアップロード、実行されてしまったりする。  

###### ⇒対策
MIMEタイプチェック、アプリケーションレベルでファイルの中身を検査する(例: PHPのfinfo_file()関数や、Pythonのmimetypesライブラリを使用)

### ③ リクエストヘッダー
| Header         | Example                                   | Description |
|----------------|-------------------------------------------|---------|
| Host           | Host: www.inlanefreight.com               | 指定されたホストを示す。ドメイン名やIPアドレスを指定し、複数のサイトをホストしているサーバーではホストヘッダーが重要なターゲットになることがある。                                         |
| User-Agent     | User-Agent: curl/7.77.0                   | リソースをリクエストするクライアントを記述する。このヘッダーからブラウザ、バージョン、OSの情報がわかる。                                                  |
| Referer        | Referer: http://www.inlanefreight.com/    | 現在のリクエスト元を示す。たとえばGoogle検索結果からのリンククリックなら、RefererはGoogleになる。このヘッダーは容易に改ざんできるため、信用すべきではない。  |
| Accept         | Accept: */*                               | クライアントが理解できるメディアタイプを示す。複数のメディアタイプをコンマで区切って指定することができる。`*/*`はすべてのメディアタイプを受け入れる。        |
| Cookie         | Cookie: PHPSESSID=b4e4fbd93540            | クライアント側とサーバー側で保存される識別子のデータ。セッション管理やユーザーの設定保存に使われる。ヘッダー内に複数のクッキーがある場合はセミコロンで区切られる。|
| Authorization  | Authorization: BASIC cGFzc3dvcmQK         | クライアントの認証情報を含むヘッダー。認証が成功すると、サーバーがクライアント専用のトークンを返す。トークンはクライアント側でのみ保存され、リクエストごとに使用される。|

#### ◇ セキュリティ的に
##### Hostについて
特定のマシンのみアクセスできるように、仮想ホストドメインがあることがあり、この場合、サーバは、Hostに示された値を見て、どのサイトに行くか判断している。特に、特定のマシン用の内部向けのWebサービスを持っているばあい、特定のマシンは以下のhostsファイルで管理していると考えられる。クライアント側では、このHostヘッダを変化させて総当たりし、管理者用のWebページや内部向けのWebページにアクセスできてしまう。
###### ⇒　対策
* httpd.confや、htaccessによるIPベースのアクセス制御
* 管理用や内部用のWebサービスは、別のポートを設定する(外部からそのポートには、FWでアクセスできないようにする)
* 外部向けのサービスと内部向けのサービスを別々のマシンで動かし、内外分ける。

##### User-Agentについて
これを変更することによって、別の端末用のWebページをサーバに要求することができる。これにより、PC向けのWebページに脆弱性がなくても、モバイル向けのWebページに脆弱性があった場合。攻撃者は、このヘッダを利用して、モバイル向けのWebページにアクセスし攻撃できる。nmapやdirbusterなどのWebに対するスパイダーや、ディレクトリスキャンはデフォルトだと、User-Agentがそのツールの名前になるようになっているので

### ④ レスポンスヘッダ
| Header             | Example                                      | Description |
|--------------------|----------------------------------------------|-------|
| Server             | Server: Apache/2.2.14 (Win32)                | リクエストを処理したHTTPサーバーに関する情報を含む。この情報を使ってサーバーのバージョンなどを知り、さらに調査することができる。 |
| Set-Cookie         | Set-Cookie: PHPSESSID=b4e4fbd93540           | クライアント識別に必要なクッキーを含む。ブラウザはこのクッキーを解析して将来のリクエストに利用する。Cookieリクエストヘッダーと同じフォーマットを持つ。                         |
| WWW-Authenticate   | WWW-Authenticate: BASIC realm="localhost"    | 要求されたリソースにアクセスするために必要な認証タイプをクライアントに通知する。 |

#### ◇ セキュリティ的に
##### Sereverについて
通信相手にWebサービスのバージョンがばれてしまう。隠す方法もあるが、そもそも最新のバージョンに変更ればあまり問題はないと思う

### ⑤ セキュリティヘッダ
| Header                     | Example                                           | Description |
|----------------------------|---------------------------------------------------|------|
| Content-Security-Policy     | Content-Security-Policy: script-src 'self'        | 外部から注入されたリソースに対するウェブサイトのポリシーを決定する。JavaScriptコードやスクリプトリソースを対象とし、特定の信頼されたドメインからのみリソースを受け取るようにブラウザに指示する。これにより、XSS（クロスサイトスクリプティング）攻撃を防ぐ。 |
| Strict-Transport-Security   | Strict-Transport-Security: max-age=31536000       | ブラウザがプレーンなHTTPプロトコルでウェブサイトにアクセスすることを防ぎ、すべての通信をHTTPSプロトコル上で行うように強制する。これにより、攻撃者がウェブトラフィックを盗聴してパスワードなどの機密情報にアクセスするのを防ぐ。 |
| Referrer-Policy             | Referrer-Policy: origin                           | ブラウザがRefererヘッダーに指定された値を含むべきかどうかを決定する。これにより、ウェブサイトを閲覧する際に機密URLや情報の漏洩を防ぐことができる。                                |
| HttpOnly                    | Set-Cookie: PHPSESSID=b4e4fbd93540; HttpOnly      | クッキーがクライアントサイドのスクリプトからアクセスされないようにする。これにより、JavaScriptによるXSS攻撃からのクッキー窃取を防ぐことができる。                         |

### ⑥ Curlを用いたヘッダのみの出力
```
curl -I $URL
```

### ⑦ Curlを用いたユーザエージェントの偽装
```
curl https://www.inlanefreight.com -A 'Mozilla/5.0'
```

# 2 ウェブリクエスト
## (1) HTTPメソッドとコード
### ① リクエストメソッド
| Method  | Description                                                    |
|---------|----------------------------------------------------------------------------|
| GET     | 特定のリソースをリクエストする。追加データはURLのクエリ文字列で送信できる (例: ?param=value)。 |
| POST    | サーバーにデータを送信する。テキストやPDF、バイナリデータをリクエストボディに追加して送信。フォームやログイン情報、画像・ドキュメントのアップロードなどで使用される。 |
| HEAD    | サーバーへのGETリクエストで返されるヘッダーだけをリクエスト。リクエストボディは返されない。リソースのサイズを確認するために使用されることが多い。 |
| PUT     | サーバー上に新しいリソースを作成する。不正に利用されると、悪意あるリソースをアップロードされる危険がある。 |
| DELETE  | サーバー上の既存リソースを削除する。不適切に保護されていると、重要なファイルを削除されDoS攻撃につながる可能性がある。                                                                   |
| OPTIONS | サーバーの受け入れるメソッドなどの情報を返す。 |
| PATCH   | 指定されたリソースに部分的な変更を適用する。                                      |

#### ◇ セキュリティ的に
PUT、DELETE、OPTIONSは、「.htaccess」や「http.conf」で制限しよう。
##### httpd.confでのメソッド制限
```httpd.conf
<Directory "/path/to/apache/docroot">
  AllowOverride All
  <LimitExcept GET POST>
     Order deny,allow
     Deny from all
  </LimitExcept>
</Directory>
```

参考：https://ameblo.jp/itboy/entry-12156343888.html

####
